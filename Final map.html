<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8' />
  <title>Create interactive hover effects with Mapbox GL JS</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css' rel='stylesheet' />
<script src="d3.js"></script>
<script src="pieChart.js"></script>

  <style>


	.legend {
	background-color: rgba(255, 255, 255, 0.75);
	border-radius: 0px;
  top: 0px;
	bottom: 0px;
	box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
	padding: 10px;
  width: 30%;
	position: absolute;
	left: 0px;
	z-index: 1;
	}

	.legend h4 {
	margin: 0 0 30px;
	}

	.legend div span {
	border-radius: 50%;
	display: inline-block;
	height: 10px;
	margin-right: 5px;
	width: 10px;
	}
    body {
      margin: 0;
      padding: 0;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }
		.signalInfo {
		  position: absolute;
		  font-family: sans-serif;
		  bottom: 0px;
		  left: 10px;
		  padding: 10px;
		  width: 75%;
		/*  border: 2px solid black;  */
		  font-size: 14px;
		  color: #222;
		  background-color:rgba(255, 255, 255, 0);
		  border-radius: 3px;
		}


/*. */


  </style>
</head>
<body>

  <div id='map'></div>



<div id="state-legend" class="legend">
  	<h2>SIGNAL ZONING NYC</h2>
    <!--	<h5>by Chengliang Li & Zhaoxiang Yun</h5>  */   -->
	<h5>This project is trying to visualize the mobile phone signal intensity in New York City
    based on the base station data and calculation through ArcGIS. Users could hover the
    mouse cursor on each hexagon to see the signal intensity in the area and click the legend
     to filter areas in different siganl intensity ranges. Also, by clicking two points on the map,
     there will be directions and a chart showing the signal changes along the route. </h5>
<h5>  <div id="reset">Click the legend to filter the map.<br> Click HERE to reset the map.</div>
	<div id="group12" class="filterButton"><span style="background-color: #FF0000"></span>87%-100%</div>
	<div id="group11" class="filterButton"><span style="background-color: #FF1616"></span>80%-87%</div>
	<div id="group10" class="filterButton"><span style="background-color: #FF2C2C"></span>73%-80%</div>
	<div id="group9" class="filterButton"><span style="background-color: #FF4242"></span>67%-73%</div>
	<div id="group8" class="filterButton"><span style="background-color: #FF5858"></span>60%-67%</div>
	<div id="group7" class="filterButton"><span style="background-color: #FF6E6E"></span>53%-60%</div>
	<div id="group6" class="filterButton"><span style="background-color: #FF8484"></span>47%-53%</div>
  <div id="group5" class="filterButton"><span style="background-color: #FF9A9A"></span>40%-47%</div>
  <div id="group4" class="filterButton"><span style="background-color: #FFB0B0"></span>33%-40%</div>
  <div id="group3" class="filterButton"><span style="background-color: #FFC6C6"></span>27%-33%</div>
  <div id="group2" class="filterButton"><span style="background-color: #ffdcdc"></span>20%-27%</div>
  <div id="group1" class="filterButton"><span style="background-color: #fff2f2"></span>0%-20%</div></h5>
  <br><br>
  <div class='signalInfo'>
  <div><strong>Signal Intensity:</strong> <span id='mag'></span></div>

  </div>
</div>
<div id="map-overlay" class="map-overlay"></div>
  <script>





    Promise.all([d3.json("NYC_Amp_Final.geojson")])
    .then(function(data){
        ready(data[0])
    })

    function ready(data){
        var map = drawMap(data)

      d3.select("#group1")
      .on("mouseover",function(){
        var filter1 = ['<','Avg_grid_code',3]
        map.setFilter('signals-viz', filter1);
      })

      d3.select("#group2")
      .on("click",function(){
        //THIS IS HOW YOU COMBINE FILTERS
        var filter2 =["all", ['>=','Avg_grid_code',3],['<','Avg_grid_code',4]]
        map.setFilter('signals-viz', filter2);
      })

      d3.select("#group3")
      .on("click",function(){
        var filter3 =["all", ['>=','Avg_grid_code',4],['<','Avg_grid_code',5]]
        map.setFilter('signals-viz', filter3);
      })

      d3.select("#group4")
      .on("click",function(){
        var filter4 =["all", ['>=','Avg_grid_code',5],['<','Avg_grid_code',6]]
        map.setFilter('signals-viz', filter4);
      })

      d3.select("#group5")
      .on("click",function(){
        var filter5 =["all", ['>=','Avg_grid_code',6],['<','Avg_grid_code',7]]
        map.setFilter('signals-viz', filter5);
      })

      d3.select("#group6")
      .on("click",function(){
        var filter6 =["all", ['>=','Avg_grid_code',7],['<','Avg_grid_code',8]]
        map.setFilter('signals-viz', filter6);
      })

      d3.select("#group7")
      .on("click",function(){
        var filter7 =["all", ['>=','Avg_grid_code',8],['<','Avg_grid_code',9]]
        map.setFilter('signals-viz', filter7);
      })

      d3.select("#group8")
      .on("click",function(){
        var filter8 =["all", ['>=','Avg_grid_code',9],['<','Avg_grid_code',10]]
        map.setFilter('signals-viz', filter8);
      })

      d3.select("#group9")
      .on("click",function(){
        var filter9 =["all", ['>=','Avg_grid_code',10],['<','Avg_grid_code',11]]
        map.setFilter('signals-viz', filter9);
      })

      d3.select("#group10")
      .on("click",function(){
        var filter10 =["all", ['>=','Avg_grid_code',11],['<','Avg_grid_code',12]]
        map.setFilter('signals-viz', filter10);
      })

      d3.select("#group11")
      .on("click",function(){
        var filter11 =["all", ['>=','Avg_grid_code',12],['<','Avg_grid_code',13]]
        map.setFilter('signals-viz', filter11);
      })


      d3.select("#group12")
  /*    .on("mouseover",function(){
        var filter12 = ['>=','Avg_grid_code',13]
        map.setFilter('signals-viz', filter12);
      })
      .on("mouseout",function(){
        map.setFilter('signals-viz',["all", ['>=','Avg_grid_code',0],['<','Avg_grid_code',20]]);
      })   */
      .on("click",function(){
        var filter12 = ['>=','Avg_grid_code',13]
        map.setFilter('signals-viz', filter12);
      })

      d3.select("#reset")
      .on("click",function(){
        map.setFilter('signals-viz',["all", ['>=','Avg_grid_code',0],['<','Avg_grid_code',20]]);
      })


    }

      function drawMap(data){

              mapboxgl.accessToken = 'pk.eyJ1IjoiMzMyMzE2MDUxIiwiYSI6ImNraHU1cm93dDExcjQycW14NHg3M2RsMGgifQ.lhxibs4TubP0hO4H9QsOsQ';
              var map = new mapboxgl.Map({
                container: 'map', // Specify the container ID
                style: 'mapbox://styles/332316051/ckit27nn31ib119nny2tt7xxo', // Specify which map style to use
                center: [-73.98, 40.78], // Specify the starting position [lng, lat]
                minZoom: 2,
                zoom: 11 // Specify the starting zoom
              });

      //     var overlay = document.getElementById('map-overlay');

           var popup = new mapboxgl.Popup({
                closeButton: false
            });


      		var magDisplay = document.getElementById('mag');

          map.on('load', function() {
        //    console.log(map.getStyle().layers)

        d3.selectAll(".mapboxgl-ctrl-logo").remove()
        d3.selectAll(".mapboxgl-ctrl-attrib").remove()

        map.addSource('signals', {
          'type': 'geojson',
          'data': './NYC_Amp_Final.geojson',
  //        'generateId': true // This ensures that all features have unique IDs
        });

        map.addLayer({
           'id': 'signals-viz',
           'type': 'fill',
           'source': 'signals',
           'source-id': 'Avg_grid_code',
           'paint': {
             'fill-color': [
               'case',
               ['boolean',
                 ['feature-state', 'hover'],
                 false
               ],

                 '#fff'
               ,
              [ 'interpolate',
               ['linear'],
               ['get', 'Avg_grid_code'],
               2, '#fff2f2',
               3, '#ffdcdc',
                       4, '#FFC6C6',
                       5, '#FFB0B0',
                       6, '#FF9A9A',
                       7, '#FF8484',
                       8, '#FF6E6E',
                       9, '#FF5858',
                       10, '#FF4242',
                       11, '#FF2C2C',
                       12, '#FF1616',
                       13, '#FF0000',]
             ],
               'fill-opacity': 0.66
           }
         });



  })

      var signalID = null;

      map.on('mousemove', 'signals-viz', (e) => {

        map.getCanvas().style.cursor = 'pointer';
        // Set variables equal to the current feature's magnitude, location, and time
      	var signalMagnitude = e.features[0].properties.Avg_grid_code;
        // Check whether features exist

        if (e.features.length > 0) {
          // Display the magnitude, location, and time in the sidebar
          var num = signalMagnitude*100/15;
          magDisplay.textContent = num.toFixed(2)+"%";



          if (signalID) {
            map.removeFeatureState({
              source: "signals",
              id: signalID
            });
          }

          signalID = e.features[0].id;

          map.setFeatureState({
            source: 'signals',
            id: signalID,
          }, {
            hover: true
          });
        }
      })

/*
map.on('load', function () {
    // Add the source to query. In this example we're using
    // county polygons uploaded as vector tiles
    map.addSource('NYC_Amp_Final', {
        'type': 'geojson',
        'data': data
    });
/*
    map.addLayer(
        {
            'id': 'hex',
            'type': 'fill',
            'source': 'NYC_Amp_Final',
            'paint': {
          //    'fill-color': '#000',
          'fill-color': [
          'interpolate',
          ['linear'],
          ['get', 'Avg_grid_code'],
          2, '#fff2f2',
          3, '#ffdcdc',
                  4, '#FFC6C6',
                  5, '#FFB0B0',
                  6, '#FF9A9A',
                  7, '#FF8484',
                  8, '#FF6E6E',
                  9, '#FF5858',
                  10, '#FF4242',
                  11, '#FF2C2C',
                  12, '#FF1616',
                  13, '#FF0000',

          ],
          'fill-opacity': 0.75
            //  'fill-stroke-width': 1,
            }
        }); // Place polygon under these labels.
  }) */
return map
}

  </script>

</body>
</html>
